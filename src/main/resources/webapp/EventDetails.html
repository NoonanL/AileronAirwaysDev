<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aileron Airways ETT</title>
<link href="StyleSheet.css" rel="styleSheet" type="text/css">
    <link rel=stylesheet type="text/css" href="StyleSheet.css">



</head>
<body>
    <header>

        <img src="images/AileronIcon.png" class="imgcontainer">
        <h1 style="font-size: 32px; text-decoration: none; text-align: center";> Event Details</h1>
        
    </header>
    <div class="row">
	   <div class="col-4">
          <h2 id="title">set me</h2>
           <h3 id="date"></h3>
           <!--<h3 id="locationHolder"></h3>-->
           <h3></h3>
           <br>
           <label id="details" class="textLabel" autofocus><h3>Event details:</h3></label>
           <!-- a div for the description-->
           <div id="descboxshadow" style="width:90%">
               <div id="description" style="width:100%; height: 100px; color:black; background-color:white; overflow-y: scroll;">
                   The wings fell off the plane!
               </div>
           </div>
           <br>
           <!-- a div for the attachments-->
           <h3 >Attachments:</h3>
           <div id="descboxshadow" style="max-height: 15%">
               <!-- scrollable div for attachments-->
               <div style="width:100%; height:100px; overflow-x: scroll;">
                   <dl id="attachments"></dl>
               </div>
           </div>
           <!-- modal box goes in here -->
           <button id="myBtn" class="button"> View Linked Events </button>
           <!-- Modal content -->
           <div id="myModal" class="modal">
               <div style ="card container centre" class="modal-content">
                   <div style ="height:50px;" class="modal-header">
                       <span class="close">&times;</span>
                   </div>
                   <div class="modal-body">
                       <div>
                           <dl id="linkedEvents"></dl>
                           <br>
                       </div>
                   </div>
                   <div style ="height:50px;" class="modal-footer"></div>
               </div>
           </div>
        </div>

        <div class="col-8">
            <p id="location">Event Location:</p>
            <div id="mapboxshadow" style="float:left">
                <div  id="map" style="width:100%"></div>
            </div>
        </div>
  
</div>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<!-- This code takes in latitude and longitude values from the API and then gives the user the location  -->	
<script>

    //construct variables used to set the information for the event details
    //This is NOT to do with linkedevents
    var sampleEventTitle="";
    var sampleEventDateTime="";
    var sampleDescription="";
    var sampleLocation="";
    // Execute Ajax GET request on URL of "someservlet" and execute the following function with Ajax response JSON...
    $.get("/eventDetailsServlet", function (responseJson) {
        console.log("got here");
        //iterate over the JSON array of timeline data passed from backend for each object append this to the page
            console.log(responseJson.title);
            sampleEventTitle=responseJson.title;
            console.log(responseJson.dateTime);
            sampleEventDateTime=responseJson.dateTime;
            console.log(responseJson.description);
            sampleDescription=responseJson.description;
            console.log("here the the response from the servlet"+ responseJson.location);
            sampleLocation=responseJson.location;
            //replace the space in the response with a comma so that the map can use it
            sampleLocation = sampleLocation.replace(" ",",");
            $("#title").text(sampleEventTitle);
            $("#date").text(sampleEventDateTime);
            $("#description").text(sampleDescription);
            //$("#locationHolder").text(sampleLocation);

    });


    function initMap() {
          
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 8,
          center: {lat:55.86, lng:-4.43}
        });
        var geocoder = new google.maps.Geocoder;
        var infowindow = new google.maps.InfoWindow;

        window.onload = function() {
          geocodeLatLng(geocoder, map, infowindow);
        };
      }
      function geocodeLatLng(geocoder, map, infowindow) {
        //plug the location from the server response into the map
        var input = sampleLocation;
        
        var latlngStr = input.split(',', 2);
        var latlng = {lat: parseFloat(latlngStr[0]), lng: parseFloat(latlngStr[1])};
        geocoder.geocode({'location': latlng}, function(results, status) {
          if (status === 'OK') {
            if (results[0]) {
              map.setZoom(12);
              var marker = new google.maps.Marker({
                position: latlng,
                map: map
              });
                 marker.addListener('click', function() {
    infowindow.open(map, marker);
  });
                
    var contentString = '<div id="content">'+
      '<div id="siteNotice">'+
      '</div>'+
      '<div id="bodyContent" style="font-size:20px;">'+
      '<p style="font-size:24px; strong;">' + results[3].formatted_address + '</p>' +
      '<p style="font-size:20px;"><b>' +sampleEventTitle + '</b></p>' +
      '<p style="text-align:center;"><b>Date: </b>' + sampleEventDateTime   +  '</p>' +
      '</div>'+
      '</div>';
                 var infowindow = new google.maps.InfoWindow({
                    content: contentString
                 });

//              infowindow.setContent(results[3].formatted_address);
              var div = document.getElementById('location');
                
                infowindow.open(map, marker);
                map.setCenter(latlng);
            } else {
              window.alert('No results found');
            }
          } else {
            window.alert('Geocoder failed due to: ' + status);
          }
        });
          
      }
    </script>
    
    
    <!--this script calls the Google maps API-->      
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCeXMUZ7brTb_FJQO40KE-ysT2OaVWQtyQ&callback=initMap">
    </script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <!-- the following is a script to create a description list of events and drop it inside the modal box-->
    <!--<script>-->
        <!--$.get("/LinkedEventsServlet", function (responseJson) {-->
            <!--console.log("hello");-->
        <!--//iterate over the JSON array of timeline data passed from backend for each object append this to the page-->
        <!--$.each(responseJson, function (index, product) {-->
            <!--//this is the object builder-->
            <!--var eventTitle = $("<h2 />", {-->
                <!--text: product.title + " - Date:" + product.DateTime,-->
                <!--"class": "eventTitle"-->
            <!--});-->
            <!--var dateTime = $("<h3 />", {-->
                <!--text: "Event date time: " + product.dateTime,-->
                <!--"class": "dateTime"-->
            <!--});-->
            <!--var eventDescription = $("<p />", {-->
                <!--text: product.description   ,-->
                <!--"class": "eventDescription"-->
            <!--});-->
            <!--var listItem = $("<dt />", {-->
                <!--text: ""-->
            <!--});-->
            <!--listItem.append(eventTitle);-->
            <!--listItem.append(dateTime);-->
            <!--listItem.append(eventDescription);-->
            <!--$("#linkedEvents").append(listItem);-->
            <!--});-->
        <!--})-->
    <!--</script>-->

    <script src="nav.js"> </script>
    <script src="modal.js"></script>
    
        
</body>
</html>





